<div class="relative flex flex-col h-full bg-white dark:bg-zinc-950">
  <!-- Decorative header background -->
  <div
    class="absolute top-0 left-0 right-0 h-40 bg-linear-to-br from-primary-500/10 via-primary-400/5 to-transparent dark:from-primary-500/15 dark:via-primary-900/10 dark:to-transparent pointer-events-none rounded-t-xl overflow-hidden"
  >
    <div
      class="absolute inset-0 opacity-30 dark:opacity-20"
      style="
        background-image:
          radial-gradient(circle at 20% 50%, var(--p-primary-300) 0px, transparent 50%),
          radial-gradient(circle at 80% 20%, var(--p-primary-200) 0px, transparent 40%);
      "
    ></div>
  </div>

  <!-- Body -->
  <div class="flex-1 overflow-y-auto px-5 pt-6 pb-4 flex flex-col gap-5">
    <!-- Header: Avatar + nombre + rol + status -->
    <div class="relative flex flex-col items-center text-center gap-3 border-b border-gray-100 dark:border-zinc-800">
      <!-- Avatar with ring -->
      <div class="relative">
        <div class="absolute inset-0 rounded-full bg-linear-to-br from-primary-400 to-primary-600 blur-md opacity-30 scale-110"></div>
        <p-avatar
          [image]="user().profile.picture.url ? user().profile.picture.url : 'images/user.png'"
          [label]="!user().profile.picture ? getInitials() : ''"
          shape="circle"
          size="xlarge"
          class="text-2xl font-bold bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300 w-24 h-24 ring-4 ring-white dark:ring-zinc-900 shadow-lg relative z-10"
        />
      </div>

      <div class="flex flex-col gap-0.5">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">{{ user().firstName }} {{ user().lastName }}</h2>
        <p class="text-sm text-gray-400 dark:text-zinc-500 font-mono">@{{ user().username }}</p>
      </div>

      <div class="flex gap-2 flex-wrap justify-center">
        <p-tag [value]="user().role.name" severity="info" [rounded]="true" class="text-xs px-3 py-1 font-medium" />
        <p-tag
          [value]="user().status.name"
          [severity]="user().status.code === 'ACTIVE' ? 'success' : 'danger'"
          [rounded]="true"
          class="text-xs px-3 py-1 font-medium"
        />
      </div>
    </div>

    <!-- Sección: Información general -->
    <div class="flex flex-col gap-3">
      <p class="text-xs font-bold uppercase tracking-widest text-primary-500 dark:text-primary-400 flex items-center gap-2">
        <span class="inline-block w-3 h-px bg-primary-400"></span>
        {{ 'crud.generalData' | translate }}
      </p>
      <div class="grid grid-cols-2 gap-x-5 gap-y-3.5">
        <div class="group flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'email.label' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100 break-all leading-snug">{{ user().email }}</p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'phone.label' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100 leading-snug">
            {{ user().profile.phone || ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'birthDate.label' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100 leading-snug">
            {{ user().profile.birthDate ? (user().profile.birthDate | date: 'mediumDate') : ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'gender.label' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100 leading-snug">
            {{ user().profile.gender.name || ('common.notProvided' | translate) }}
          </p>
        </div>
      </div>
    </div>

    <!-- Bio -->
    @if (user().profile.bio) {
    <div class="flex flex-col gap-2.5">
      <p class="text-xs font-bold uppercase tracking-widest text-primary-500 dark:text-primary-400 flex items-center gap-2">
        <span class="inline-block w-3 h-px bg-primary-400"></span>
        {{ 'bio.label' | translate }}
      </p>
      <p
        class="text-sm text-gray-600 dark:text-zinc-300 leading-relaxed bg-gray-50 dark:bg-zinc-800/60 rounded-xl p-3.5 border border-gray-100 dark:border-zinc-700/50 italic"
      >
        "{{ user().profile.bio }}"
      </p>
    </div>
    }

    <!-- Dirección -->
    @if (user().profile.address) {
    <div class="flex flex-col gap-3">
      <p class="text-xs font-bold uppercase tracking-widest text-primary-500 dark:text-primary-400 flex items-center gap-2">
        <span class="inline-block w-3 h-px bg-primary-400"></span>
        {{ 'address.label' | translate }}
      </p>
      <div class="grid grid-cols-2 gap-x-5 gap-y-3.5">
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'address.street' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100">
            {{ user().profile.address.street || ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'address.city' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100">
            {{ user().profile.address.city || ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'address.state' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100">
            {{ user().profile.address.state || ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'address.country' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100">
            {{ user().profile.address.country || ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'address.zipCode' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100">
            {{ user().profile.address.zipCode || ('common.notProvided' | translate) }}
          </p>
        </div>
      </div>
    </div>
    }

    <!-- Preferencias -->
    @if (user().preferences) {
    <div class="flex flex-col gap-3">
      <p class="text-xs font-bold uppercase tracking-widest text-primary-500 dark:text-primary-400 flex items-center gap-2">
        <span class="inline-block w-3 h-px bg-primary-400"></span>
        {{ 'preferences.label' | translate }}
      </p>
      <div class="grid grid-cols-2 gap-x-5 gap-y-3.5">
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'preferences.timezone' | translate }}
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100">
            {{ user().preferences.timezone || ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'preferences.notifications' | translate }}
          </p>
          <div>
            <p-tag
              [value]="(user().preferences.notificationsEnabled ? 'common.enabled' : 'common.disabled') | translate"
              [severity]="user().preferences.notificationsEnabled ? 'success' : 'secondary'"
              [rounded]="true"
              class="text-xs"
            />
          </div>
        </div>
        <div class="flex flex-col gap-1.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'preferences.emailNotifications' | translate }}
          </p>
          <div>
            <p-tag
              [value]="(user().preferences.emailNotifications ? 'common.enabled' : 'common.disabled') | translate"
              [severity]="user().preferences.emailNotifications ? 'success' : 'secondary'"
              [rounded]="true"
              class="text-xs w-auto"
            />
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Seguridad -->
    @if (user().security) {
    <div class="flex flex-col gap-3">
      <p class="text-xs font-bold uppercase tracking-widest text-primary-500 dark:text-primary-400 flex items-center gap-2">
        <span class="inline-block w-3 h-px bg-primary-400"></span>
        {{ 'security.label' | translate }}
      </p>
      <div class="grid grid-cols-2 gap-x-5 gap-y-3.5">
        <div class="flex flex-col gap-1.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'security.emailVerified' | translate }}
          </p>
          <div>
            <p-tag
              [value]="(user().security.emailVerified ? 'common.verified' : 'common.notVerified') | translate"
              [severity]="user().security.emailVerified ? 'success' : 'warn'"
              [rounded]="true"
              class="text-xs"
            />
          </div>
        </div>
        <div class="flex flex-col gap-1.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'security.phoneVerified' | translate }}
          </p>
          <div>
            <p-tag
              [value]="(user().security.phoneVerified ? 'common.verified' : 'common.notVerified') | translate"
              [severity]="user().security.phoneVerified ? 'success' : 'warn'"
              [rounded]="true"
              class="text-xs"
            />
          </div>
        </div>
        <div class="flex flex-col gap-1.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'security.twoFactor' | translate }}</p>
          <div>
            <p-tag
              [value]="(user().security.twoFactorEnabled ? 'common.enabled' : 'common.disabled') | translate"
              [severity]="user().security.twoFactorEnabled ? 'success' : 'secondary'"
              [rounded]="true"
              class="text-xs"
            />
          </div>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">{{ 'security.lastLogin' | translate }}</p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100 leading-snug">
            {{ user().security.lastLoginAt ? (user().security.lastLoginAt | date: 'medium') : ('common.notProvided' | translate) }}
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'security.failedAttempts' | translate }}
          </p>
          <p
            class="text-sm font-semibold leading-snug flex items-center gap-1"
            [ngClass]="user().security.failedLoginAttempts > 0 ? 'text-red-500' : 'text-gray-800 dark:text-zinc-100'"
          >
            {{ user().security.failedLoginAttempts }} @if (user().security.failedLoginAttempts > 0) {
            <span class="text-xs font-normal text-red-400">⚠ intentos</span>
            }
          </p>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-500 font-medium">
            {{ 'security.passwordChanged' | translate }}
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-zinc-100 leading-snug">
            {{ user().security.passwordChangedAt ? (user().security.passwordChangedAt | date: 'mediumDate') : ('common.notProvided' |
            translate) }}
          </p>
        </div>
      </div>
    </div>
    }

    <!-- Timestamps -->
    <div class="flex flex-col gap-3 border-t border-gray-100 dark:border-zinc-800">
      <div class="grid grid-cols-2 gap-x-5 gap-y-2">
        <div class="flex flex-col gap-0.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-600 font-medium">{{ 'date.createdAt' | translate }}</p>
          <p class="text-xs font-medium text-gray-500 dark:text-zinc-500">{{ user().createdAt | date: 'medium' }}</p>
        </div>
        <div class="flex flex-col gap-0.5">
          <p class="text-xs uppercase tracking-wide text-gray-400 dark:text-zinc-600 font-medium">{{ 'date.updatedAt' | translate }}</p>
          <p class="text-xs font-medium text-gray-500 dark:text-zinc-500">{{ user().updatedAt | date: 'medium' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer sticky -->
  <div
    class="sticky bottom-0 left-0 right-0 border-t border-gray-100 dark:border-zinc-800 px-4 py-3 bg-white/95 dark:bg-zinc-950/95 backdrop-blur-sm"
  >
    <div class="flex flex-col sm:flex-row gap-2.5">
      <p-button
        (onClick)="close()"
        [label]="'actions.close' | translate"
        severity="secondary"
        [fluid]="true"
        [size]="'large'"
        class="sm:flex-1"
        styleClass="font-medium"
      />
      <p-button
        (onClick)="redirectUpdate()"
        [label]="'actions.update' | translate"
        [raised]="true"
        severity="primary"
        [fluid]="true"
        [size]="'large'"
        class="sm:flex-1"
        styleClass="font-semibold"
        icon="ph ph-pencil-simple"
        iconPos="right"
      />
    </div>
  </div>
</div>
